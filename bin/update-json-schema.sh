#/bin/bash
set -e
# set -x

MYDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

JQ_IMPROVE_GENERATED='.["$id"] = "https://github.com/ossf-cve-benchmark/ossf-cve-benchmark/schemas/ts-defs.schema.json" |
.title = "Generated schema types from src/persistent-types.ts"'
./node_modules/.bin/ts-json-schema-generator -f ./tsconfig.json --path src/persistent-types.ts |
    jq "${JQ_IMPROVE_GENERATED}" > schemas/ts-defs.schema.json

TMP=$(mktemp -d -t jsonschema2md_XXXX)

cd "${TMP}"
"${MYDIR}/../node_modules/@adobe/jsonschema2md/cli.js" --no-readme -d "${MYDIR}/../schemas"

OUT="${MYDIR}/../docs/json-schema"
mkdir -p "${OUT}"
rm -r "${OUT}"
mv "${TMP}/out" "${OUT}"
