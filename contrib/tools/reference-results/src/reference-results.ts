import {
  AnalyzeParams,
  drive,
  getDriverCommandlineInputs
} from "../../../../src/driver";
import { BCVEResultStatus } from "../../../../src/types";

let { toolID, bcves, config } = getDriverCommandlineInputs();
drive(
  bcves,
  config,
  toolID,
  async function analyze({
    bcve,
    commitDescription,
    setAlerts,
    setStatus
  }: AnalyzeParams) {
    setAlerts(
      (commitDescription.weaknesses || []).map(w => ({
        ruleID: `rule-for-${bcve.CVE}`,
        location: w.location
      }))
    );
    setStatus(BCVEResultStatus.SUCCESS);
  },
  false
)
  .then(() => process.exit(0))
  .catch(e => {
    console.error(e);
    process.exit(1);
  });
