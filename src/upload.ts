import * as cp from "child_process";
import { BCVE, Dir } from "./types";

export function upload(bcve: BCVE, repository_root: string) {
  function uploadCommit(
    dir: Dir,
    commit: string,
    repository: string,
    branchName: string
  ) {
    cp.execFileSync("git", [
      "-C",
      dir,
      "push",
      repository,
      `${commit}:refs/heads/${branchName}`
    ]);
  }
  let repository = `${repository_root}/${bcve.CVE}.git`;

  uploadCommit(
    bcve.patchBase.localSourceDirectory,
    bcve.patchBase.commit,
    repository,
    `patchBase`
  );
  uploadCommit(
    bcve.postPatch.localSourceDirectory,
    bcve.postPatch.commit,
    repository,
    `postPatch`
  );
}
